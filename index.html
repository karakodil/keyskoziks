<!DOCTYPE html>
<html>
<head>
    <title>Password Check</title>
    <script>
        // База данных в localStorage
        function getDatabase() {
            return JSON.parse(localStorage.getItem('passwordDB') || '{}');
        }
        
        function saveDatabase(db) {
            localStorage.setItem('passwordDB', JSON.stringify(db));
        }
        
        // Обработка параметров URL
        function handlePasswordCheck() {
            const urlParams = new URLSearchParams(window.location.search);
            const password = urlParams.get('pwd');
            const deviceId = urlParams.get('did');
            
            if (password && deviceId) {
                const db = getDatabase();
                
                if (!db[deviceId]) {
                    // Первый вход - сохраняем
                    db[deviceId] = password;
                    saveDatabase(db);
                    return 'OK';
                } else if (db[deviceId] === password) {
                    // Пароль верный
                    return 'OK';
                } else {
                    // Пароль неверный
                    return 'INVALID';
                }
            }
            return 'READY';
        }
        
        // При загрузке страницы
        const result = handlePasswordCheck();
        
        // Если есть параметры - показываем результат
        if (window.location.search) {
            document.write(result);
        } else {
            // Иначе показываем обычную страницу
            document.body.innerHTML = `
                <h1>Password Verification API</h1>
                <p>Server is running!</p>
                <p>Status: ${result}</p>
            `;
        }
    </script>
</head>
<body>
</body>
</html>
